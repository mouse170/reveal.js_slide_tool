<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>影片同步播放</title>
 <script src="http://localhost:8125/socket.io/socket.io.js"></script>
<script type="text/javascript">
window.addEventListener('load', eventWindowLoaded, false);  
var loadCount=0;
var itemsToLoad = 2;
var videoElement;
var videoDiv;
var buttonSheet;
var isServer=false;

function eventWindowLoaded() {
  videoElement = document.createElement("video");
  videoDiv = document.createElement('div');
  document.body.appendChild(videoDiv);
  videoDiv.appendChild(videoElement);
  videoDiv.setAttribute("style", "display:none;");
  var videoType = supportedVideoFormat(videoElement);
  if (videoType == "") {
    alert("no video support");
    return;
  }
  videoElement.setAttribute("src", "video." + videoType);
  videoElement.addEventListener("canplay",itemLoaded,false);
  buttonSheet = new Image();
  buttonSheet.onload = itemLoaded;
  buttonSheet.src = "videobuttons.png";
  
}

function supportedVideoFormat(video) {
  var returnExtension = "";
  if (video.canPlayType("video/webm") =="probably" || video.canPlayType("video/webm") == "maybe") {
    returnExtension = "webm";
  } else if(video.canPlayType("video/mp4") == "probably" || video.canPlayType("video/mp4") == "maybe") {
    returnExtension = "mp4";
  } else if(video.canPlayType("video/ogg") =="probably" || video.canPlayType("video/ogg") == "maybe") {
    returnExtension = "ogg";
  } 
  
  return returnExtension;
  
}





function itemLoaded() {
  loadCount++;
  if (loadCount >= itemsToLoad) {
    canvasApp();
  }

}



function canvasApp() {

  function  drawScreen () {

    //Background
    
    context.fillStyle = '#ffffaa';
    context.fillRect(0, 0, theCanvas.width, theCanvas.height);
    //Box
    context.strokeStyle = '#000000'; 
    context.strokeRect(5,  5, theCanvas.width-10, theCanvas.height-10);
    //video
    context.drawImage(videoElement , 30, 30);
    //Draw Buttons
    //Play
    
    if (!videoElement.paused) {
      context.drawImage(buttonSheet, 0,32,bW,bH,playX,playY,bW,bH); //Play Down
      
    } else {
      context.drawImage(buttonSheet, 0,0,bW,bH,playX,playY,bW,bH); //Play up
      
    
    }
    
    if (videoElement.paused) {
      context.drawImage(buttonSheet,  32,32,bW,bH,pauseX,pauseY,bW,bH); // Pause down
    } else {
      context.drawImage(buttonSheet,  32,0,bW,bH,pauseX,pauseY,bW,bH); // Pause up
    }
    
    context.drawImage(buttonSheet,  64,0,bW,bH,stopX,stopY,bW,bH); // Stop up
    
      
      
  }
  
    function eventMouseUp(event) {
    
    var mouseX;
    var mouseY;
    
    if ( event.layerX ||  event.layerX == 0) { // Firefox
        mouseX = event.layerX ;
        mouseY = event.layerY;
      } else if (event.offsetX || event.offsetX == 0) { // Opera
        mouseX = event.offsetX;
        mouseY = event.offsetY;
      }
    //Hit Play
    if ( (mouseY >= playY) && (mouseY <= playY+bH) && (mouseX >= playX) && (mouseX <= playX+bW) ) {
      if (videoElement.paused) {
        videoElement.play();
        
      } 
    
    }
    
    //Hit Stop
    
    if ( (mouseY >= stopY) && (mouseY <= stopY+bH) && (mouseX >= stopX) && (mouseX <= stopX+bW) ) {
      
      videoElement.pause();
      videoElement.currentTime = 0;
    }
    
    //Hit Pause
    if ( (mouseY >= pauseY) && (mouseY <= pauseY+bH) && (mouseX >= pauseX) && (mouseX <= pauseX+bW) ) {
      
      if (videoElement.paused == false) {
        videoElement.pause();
      } else {
        videoElement.play();
      }
    
    }
  
    
  
  }
  
  var theCanvas = document.getElementById('canvasOne');
  var context = theCanvas.getContext('2d');
  
  
  var bW        = 32;
  var bH        = 32;
  var playX       = 100;
  var playY       = 400; 
  var pauseX      = 140;
  var pauseY      = 400;
  var stopX       = 180
  var stopY       = 400;
  
  
  theCanvas.addEventListener("mouseup",eventMouseUp, false);    
  
  setInterval(drawScreen, 33);  
// 擷取canvas的data
imgData=context.getImageData(30,30,700,480);

  
}
// 外部取得canvas的資訊
var imgData;
</script>

</head>
<body>
<div style="position: absolute; top: 50px; left: 50px;">

<canvas id="canvasOne" width="702" height="480">
 Your browser does not support the HTML 5 Canvas. 
</canvas>
</div>

</body>
</html>




